<!DOCTYPE html>
<html>
<head>
    <title>NoteView Component Dev UI</title>
    <style>
        body { font-family: sans-serif; }
        .dev-ui-container { display: flex; }
        .component-preview-area { flex: 2; padding: 20px; border-right: 1px solid #ccc; }
        .controls-panel { flex: 1; padding: 20px; }
        .editor-area { /* Keep editor-area styles for Edit component within NoteView */
            border: 1px solid #ccc;
            padding: 10px;
            min-height: 200px;
            tab-size: 4;
            white-space: pre-wrap;
            font-family: monospace;
        }
        #note-view-container { /* Style for NoteView container if needed */
            border: 1px dashed blue; /* Example border to visualize NoteView area */
            padding: 10px;
        }
    </style>
</head>
<body>
    <h1>NoteView Component Dev UI</h1>
    <div class="dev-ui-container">
        <div class="component-preview-area">
            <h2>NoteView Component Preview</h2>
            <div id="note-view-container">
                <!-- NoteView component will be rendered here -->
            </div>
        </div>
        <div class="controls-panel">
            <h2>Controls</h2>
            <div id="note-loading-controls">
                <h3>Load Notes</h3>
                <button id="load-note-1-button">Load Note 1</button><br><br>
                <button id="load-note-2-button">Load Note 2</button><br><br>
            </div>
        </div>
    </div>

    <script type="module">
        import { NoteView } from './ui/view.note.js';
        import { createAppMock } from './test/test-utils.js';
        import * as Y from 'yjs';

        document.addEventListener('DOMContentLoaded', () => {
            const noteViewContainer = document.getElementById('note-view-container');
            const loadNote1Button = document.getElementById('load-note-1-button');
            const loadNote2Button = document.getElementById('load-note-2-button');

            let noteViewInstance;
            let appMock = createAppMock(); // Get a base mock app object

            // Mock DB.get to return different notes for note1 and note2
            appMock.db.get = async (noteId) => {
                if (noteId === 'note1') {
                    return { id: 'note1', name: 'Note 1', content: 'This is the content of Note 1.' };
                } else if (noteId === 'note2') {
                    return { id: 'note2', name: 'Note 2', content: 'Content for Note 2 is different.' };
                }
                return null; // Or handle default case
            };

            // Mock getTagDefinition - for simplicity, return a default string tag definition
            appMock.getTagDefinition = (tagName) => {
                return {
                    name: tagName,
                    label: tagName,
                    ui: { type: "text" },
                    validate: () => true,
                    conditions: ["is", "contains"]
                };
            };
            appMock.schema = {}; // Mock schema if needed
            appMock.store = { // Mock store for NoteView
                dispatch: () => {},
                subscribe: () => {},
                getState: () => ({ selectedNoteId: null }) // Initial state
            };
            appMock.errorHandler = { handleError: console.error }; // Mock errorHandler
            appMock.noteManager = { saveObject: () => {}, createNote: () => {} }; // Mock noteManager
            appMock.noteYjsHandler = { getYNoteMap: () => {} }; // Mock noteYjsHandler
            appMock.notificationManager = { showNotification: console.log }; // Mock notificationManager
            appMock.ontology = {}; // Mock ontology

            noteViewInstance = new NoteView( // Create NoteView instance
                appMock.store,
                appMock.db,
                appMock.errorHandler,
                appMock.noteManager,
                appMock.noteYjsHandler,
                appMock.notificationManager,
                appMock.ontology
            );
            noteViewContainer.appendChild(noteViewInstance); // Append NoteView to container


            loadNote1Button.addEventListener('click', () => {
                noteViewInstance.loadNote('note1');
            });

            loadNote2Button.addEventListener('click', () => {
                noteViewInstance.loadNote('note2');
            });
        });
    </script>
</body>
</html>
